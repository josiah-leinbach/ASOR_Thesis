---
title: "Post-Experiment Analysis on R1 = 2, R2 = 1"
author: "Josiah Leinbach"
date: "2024-06-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tseries)
library(dplyr)
library(tidyverse)
```

# Build initial table for (R1 = 2, R2 = 1)
```{r}
rds_2.1 <- readRDS("EMR-R1.2-R2.1-9pos.rds")
styles_mat.0 <- matrix(data = 0, nrow = 13, ncol = 3)
id <- rds_2.1$id

for (i in 1:13) {
  for (j in 1:3) {
    styles_mat.0[i,j] <- sum(id[i,] == j, na.rm = T)
  }
}

colnames(styles_mat.0) <- c("Paul_1", "Paul_2", "Non-Paul_1")

N <- rowSums(styles_mat.0)
styles_mat.0 <- as.data.frame(styles_mat.0)
```

## Runs test
The distribution of styles can reveal much when investigating claims of authorship, and given that subject matter, tone, structure, and genre all influence syntax, it seems probable that styles will have a tendency to "cluster". For $d_1$ books of assumed Pauline authorship, we will examine the distribution of $R_1$ versus $R_2$ styles, and for $d_2$ books, we will examine the distribution of $R_1$ and $R_2$ styles versus $R_3$ styles. If many of the $R_3$ sentences cluster together, that would be evidence that new or unique subject matter in the corpus may better explain their presence than a different author, in which case we would expect a more homogenous distribution.

```{r}
sent_mod <- vector(mode = "list", length = 13)
for (i in 1:13) {
  sent_id <- id[i, 1:N[i]]
  sent_mod[[i]] <- sent_id
}

sent_run <- sent_mod

for (i in 1:7) {
  sent_sub <- sent_run[[i]]
  vec.1 <- sent_sub == 1
  vec.2 <- sent_sub == 2
  sent_sub[vec.1] <- "P1"
  sent_sub[vec.2] <- "P2"
  sent_run[[i]] <- factor(sent_sub)
}

for (i in 8:13) {
  sent_sub <- sent_run[[i]]
  vec.P <- sent_sub == 1 | sent_sub == 2
  vec.N <- sent_sub == 3
  sent_sub[vec.P] <- "P"
  sent_sub[vec.N] <- "N"
  sent_run[[i]] <- factor(sent_sub)
}

Run.Results <- numeric(13)
for (i in 1:13) {
  r <- sent_run[[i]]
  result <- runs.test(r)
  Run.Results[i] <- result$p.value
}
```

## Add to existing data frame
```{r}
books_vec <- c("Rom", "Cor.1", "Cor.2", "Gal", "Php", "Thes.1", "Phm", "Eph", "Col", "Thes.2",
               "Tim.1", "Tim.2", "Tit")
styles_mat.0$Book <- books_vec
styles_mat.0$Run.Results <- round(Run.Results, 8)

styles_mat.0 <- styles_mat.0 %>%
  rowwise() %>%
  mutate(Paul_perc = sum(Paul_1, Paul_2)/sum(Paul_1, Paul_2, `Non-Paul_1`))
styles_mat.0 <- styles_mat.0 %>% 
  relocate(Book, .before = Paul_1) %>%
  relocate(Paul_perc, .before = Run.Results)
```

# Results with tests on various books
## Philippians
### EM Algorithm on 7 Undisputed Minus Philippians
```{r}
rds_php <- readRDS("EMR-R1.2-R2.1-9pos_Test.Php.rds")
id <- rds_php$id
styles_mat <- matrix(data = 0, nrow = 13, ncol = 3)

for (i in 1:13) {
  for (j in 1:3) {
    styles_mat[i,j] <- sum(id[i,] == j, na.rm = T)
  }
}
colnames(styles_mat) <- c("Paul_1", "Paul_2", "Non-Paul_1")
styles_mat <- as_tibble(styles_mat)

books_vec <- c("Rom", "Cor.1", "Cor.2", "Gal", "Thes.1", "Phm", "Eph", "Col", "Thes.2",
                 "Tim.1", "Tim.2", "Tit", "Php")
styles_mat$Book <- books_vec
book.type <- factor(c("Disputed_Non.PE","Undisputed","Undisputed","Disputed_Non.PE","Undisputed",
               "Undisputed","Undisputed","Undisputed","Undisputed","Disputed_Non.PE",
               "Disputed_PE","Disputed_PE","Disputed_PE"))

styles_mat <- styles_mat %>%
  rowwise() %>%
  mutate(Total_sent = sum(Paul_1, Paul_2, `Non-Paul_1`)) %>%
  mutate(Paul_perc = sum(Paul_1, Paul_2)/sum(Paul_1, Paul_2, `Non-Paul_1`)) %>%
  relocate(Book, .before = Paul_1) %>%
  arrange(Book) %>%
  add_column(Class = book.type) %>%
  relocate(Class, .before = Paul_1)
```

### EM Algorithm on all 7 Undisputed
```{r}
id.2 <- rds_2.1$id
styles_mat.2 <- matrix(data = 0, nrow = 13, ncol = 3)

for (i in 1:13) {
  for (j in 1:3) {
    styles_mat.2[i,j] <- sum(id.2[i,] == j, na.rm = T)
  }
}

colnames(styles_mat.2) <- c("Paul_1", "Paul_2", "Non-Paul_1")
styles_mat.2 <- as_tibble(styles_mat.2)

books_vec.2 <- c("Rom", "Cor.1", "Cor.2", "Gal", "Php", "Thes.1", "Phm", "Eph", "Col", "Thes.2",
               "Tim.1", "Tim.2", "Tit")
styles_mat.2$Book <- books_vec.2

styles_mat.2 <- styles_mat.2 %>%
  rowwise() %>%
  mutate(Total_sent = sum(Paul_1, Paul_2, `Non-Paul_1`)) %>%
  mutate(Paul_perc = sum(Paul_1, Paul_2)/sum(Paul_1, Paul_2, `Non-Paul_1`)) %>% 
  relocate(Book, .before = Paul_1) %>%
  arrange(Book) %>%
  add_column(Class = book.type) %>%
  relocate(Class, .before = Paul_1)
```

### Compare results
```{r}
test_diff <- tibble(
  Book = styles_mat$Book,
  Class = styles_mat$Class,
)
test_diff.1 <- styles_mat[,c(3,4,5,7)] - styles_mat.2[,c(3,4,5,7)]

styles_diff <- tibble(test_diff, test_diff.1)
```
